

<!DOCTYPE html>
<html class="writer-html5" lang="zh-hans" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>插件教程 &mdash; Blender Manual</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.blender.org/manual/en/latest/advanced/scripting/addon_tutorial.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/version_switch.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Blender Manual"
          href="../../_static/opensearch.xml"/>
    <link rel="alternate" hreflang="en" href="https://docs.blender.org/manual/en/latest/">
    <link rel="alternate" hreflang="de" href="https://docs.blender.org/manual/de/latest/">
    <link rel="alternate" hreflang="es" href="https://docs.blender.org/manual/es/latest/">
    <link rel="alternate" hreflang="fi" href="https://docs.blender.org/manual/fi/latest/">
    <link rel="alternate" hreflang="fr" href="https://docs.blender.org/manual/fr/latest/">
    <link rel="alternate" hreflang="it" href="https://docs.blender.org/manual/it/latest/">
    <link rel="alternate" hreflang="ja" href="https://docs.blender.org/manual/ja/latest/">
    <link rel="alternate" hreflang="ko" href="https://docs.blender.org/manual/ko/latest/">
    <link rel="alternate" hreflang="nb" href="https://docs.blender.org/manual/nb/latest/">
    <link rel="alternate" hreflang="pt" href="https://docs.blender.org/manual/pt/latest/">
    <link rel="alternate" hreflang="ru" href="https://docs.blender.org/manual/ru/latest/">
    <link rel="alternate" hreflang="sl" href="https://docs.blender.org/manual/sl/latest/">
    <link rel="alternate" hreflang="sr" href="https://docs.blender.org/manual/sr/latest/">
    <link rel="alternate" hreflang="uk" href="https://docs.blender.org/manual/uk/latest/">
    <link rel="alternate" hreflang="vi" href="https://docs.blender.org/manual/vi/latest/">
    <link rel="alternate" hreflang="zh-Hans" href="https://docs.blender.org/manual/zh-hans/latest/">
    <link rel="alternate" hreflang="zh-Hant" href="https://docs.blender.org/manual/zh-hant/latest/">
    <link rel="alternate" hreflang="x-default" href="https://docs.blender.org/manual/en/latest/">
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="应用模板" href="../app_templates.html" />
    <link rel="prev" title="脚本与安全" href="security.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Blender 2.90 Manual
          

          
            
            <img src="../../_static/blender-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Blender入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interface/index.html">用户界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editors/index.html">编辑器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scene_layout/index.html">场景 &amp; 物体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling/index.html">制作模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sculpt_paint/index.html">雕刻 &amp; 绘制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../grease_pencil/index.html">蜡笔</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../animation/index.html">动画 &amp; 绑定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../physics/index.html">物理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../render/index.html">渲染</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compositing/index.html">合成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../movie_clip/index.html">跟踪 &amp; 遮罩</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../video_editing/index.html">视频编辑</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files/index.html">文件 &amp; 数据系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../addons/index.html">插件</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">高级应用</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../command_line/index.html">命令行</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">脚本与扩展Blender</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">脚本与安全</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">插件教程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#intended-audience">目标读者</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#prerequisites">前提</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#documentation-links">文档链接</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-is-an-add-on">何为插件？</a></li>
<li class="toctree-l4"><a class="reference internal" href="#your-first-add-on">第一个插件</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#write-the-script">写脚本</a></li>
<li class="toctree-l5"><a class="reference internal" href="#write-the-add-on-simple">写插件 (简易)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#install-the-add-on">安装插件</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#your-second-add-on">第二个插件</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id1">写脚本</a></li>
<li class="toctree-l5"><a class="reference internal" href="#write-the-add-on">写插件</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#operator-property">操作属性</a></li>
<li class="toctree-l6"><a class="reference internal" href="#menu-item">菜单选项</a></li>
<li class="toctree-l6"><a class="reference internal" href="#keymap">键位映射</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bringing-it-all-together">合二为一</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#conclusions">结语</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#further-reading">扩展阅读</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_templates.html">应用模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keymap_editing.html">键位映射自定义</a></li>
<li class="toctree-l2"><a class="reference internal" href="../limits.html">功能局限</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operators.html">操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blender_directory_layout.html">Blender目录布局</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">问题排查</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/index.html">词汇表</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">贡献文档</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Blender 2.90 Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">高级应用</a> &raquo;</li>
        
          <li><a href="index.html">脚本与扩展Blender</a> &raquo;</li>
        
      <li>插件教程</li>
    
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="add-on-tutorial">
<h1>插件教程<a class="headerlink" href="#add-on-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intended-audience">
<h2>目标读者<a class="headerlink" href="#intended-audience" title="Permalink to this headline">¶</a></h2>
<p>本篇教程旨在帮助技术型艺术家或者开发者学习如何扩展Blender。对于通读全文的读者，需要通晓Python的基础知识。</p>
<div class="section" id="prerequisites">
<h3>前提<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>阅读本教程前，用户需要：</p>
<ul class="simple">
<li><p>熟悉Blender中的基础功能。</p></li>
<li><p>知道如何在Blender的文本编辑器中运行脚本。</p></li>
<li><p>Have an understanding of Python primitive types (integer, Boolean, string, list, tuple, dictionary, and set).</p></li>
<li><p>熟悉Python模块的概念。</p></li>
<li><p>对Python中的类(面向对象)有基础认知。</p></li>
</ul>
<p>学习本教程前建议阅读。</p>
<ul class="simple">
<li><p><a class="reference external" href="http://getpython3.com/diveintopython3/index.html">深入Python</a> 章节(1, 2, 3, 4, 和 7)。</p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/blender_python_api_current/info_quickstart.html">Blender API快速入门</a> 有助于更加熟悉Blender/Python基础。</p></li>
</ul>
<p>为了在编写脚本时更好的排查Python打印的错误，可以从终端启动Blender。参见 <a class="reference external" href="https://docs.blender.org/api/blender_python_api_current/info_tips_and_tricks.html#use-the-terminal">使用终端</a>。</p>
</div>
</div>
<div class="section" id="documentation-links">
<h2>文档链接<a class="headerlink" href="#documentation-links" title="Permalink to this headline">¶</a></h2>
<p>在阅读教程时，用户可能需要查找参考文档。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.blender.org/api/blender_python_api_current/info_overview.html">blender_api:Blender API概述</a>. - 这份文档相当详细，不过如果你想对某个话题了解更多的话，这很有用。</p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/2.90/bpy.context.html#module-bpy.context" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">bpy.context</span></code></a> API参考. - 可以方便地获得脚本可以调用的选项。</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.Operator</span></code>. - 下文的插件会定义操作，这些文档提供了更多操作的范例和细节。</p></li>
</ul>
</div>
<div class="section" id="what-is-an-add-on">
<h2>何为插件？<a class="headerlink" href="#what-is-an-add-on" title="Permalink to this headline">¶</a></h2>
<p>插件是附加一些额外要求的Python模块，这样Blender可以列表形式显示有用信息。</p>
<p>下面的例子是一个最简单的插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;My Test Add-on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Goodbye World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bl_info</span></code></dt><dd><p>一个字典，包含插件元数据如标题、版本和作者，这些信息会显示在用户设置的插件列表。它还指定了运行该脚本的最低版本要求；更老的版本无法在插件列表中显示该插件。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">register</span></code></dt><dd><p>仅在启用插件时运行的函数，这意味着无需激活插件即可加载模块。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unregister</span></code></dt><dd><p>用于卸载 <code class="docutils literal notranslate"><span class="pre">register</span></code> 建立的数据的函数，在禁用插件时调用。</p>
</dd>
</dl>
<p>注意：该插件不会进行任何Blender相关操作(比如不会载入 <a class="reference external" href="https://docs.blender.org/api/2.90/bpy.data.html#module-bpy" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">bpy</span></code></a> 模块)。</p>
<p>这是一个刻意设计的插件示例，用于说明插件的基础要求其实很简单。</p>
<p>插件通常会注册操作、面板、菜单选项等，不过这没有多大价值，从文本编辑器，甚至交互控制台执行的脚本也可以做到 -- 插件与Blender的结合方式并没有本质上的不同, 这些功能都是 <a class="reference external" href="https://docs.blender.org/api/2.90/bpy.data.html#module-bpy" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">bpy</span></code></a> 模块提供的，任何脚本都可以访问。</p>
<p>所以，插件仅仅是一种封装Python模块的方法，以方便用户使用。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在文本编辑器运行这个脚本不会有任何输出，必须通过用户设置安装该脚本才能看到输出。启用和禁用时均会打印提示信息。</p>
</div>
</div>
<div class="section" id="your-first-add-on">
<h2>第一个插件<a class="headerlink" href="#your-first-add-on" title="Permalink to this headline">¶</a></h2>
<p>上文中的最简插件除举例外别无它用。下面的插件也很简单，不过演示了如何使用一个 <code class="docutils literal notranslate"><span class="pre">Operator</span></code> 将脚本集成到Blender，<code class="docutils literal notranslate"><span class="pre">Operator</span></code> 是用于定义可从菜单、按钮和快捷键访问的工具的特有方法。</p>
<p>首先，写一个移动场景内所有物体的脚本。</p>
<div class="section" id="write-the-script">
<h3>写脚本<a class="headerlink" href="#write-the-script" title="Permalink to this headline">¶</a></h3>
<p>在文本编辑器添加下面的脚本:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>按下 <a class="reference internal" href="../../editors/text_editor.html#editors-text-run-script"><span class="std std-ref">运行脚本按钮</span></a>, 活动场景内的所有物体均会移动1个Blender单位。</p>
</div>
<div class="section" id="write-the-add-on-simple">
<h3>写插件 (简易)<a class="headerlink" href="#write-the-add-on-simple" title="Permalink to this headline">¶</a></h3>
<p>这个插件使用了上面的脚本，并将其添加到一个operator的 <code class="docutils literal notranslate"><span class="pre">execute()</span></code> 函数中。:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Move X Axis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectMoveX</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;My Object Moving Script&quot;&quot;&quot;</span>      <span class="c1"># Use this as a tooltip for menu items and buttons.</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.move_x&quot;</span>        <span class="c1"># Unique identifier for buttons and menu items to reference.</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Move X by One&quot;</span>         <span class="c1"># Display name in the interface.</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>  <span class="c1"># Enable undo for the operator.</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>        <span class="c1"># execute() is called when running the operator.</span>

        <span class="c1"># The original script</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>            <span class="c1"># Lets Blender know the operator finished successfully.</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectMoveX</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectMoveX</span><span class="p">)</span>


<span class="c1"># This allows you to run the script directly from Blender&#39;s Text editor</span>
<span class="c1"># to test the add-on without having to install it.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">bl_info</span></code> 被分割成多行，这仅仅是一种编程风格，可以方便添加元素。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这里传递给 <code class="docutils literal notranslate"><span class="pre">execute()</span></code> 的参数是 <code class="docutils literal notranslate"><span class="pre">context.scene</span></code> ，而非 <code class="docutils literal notranslate"><span class="pre">bpy.context.scene</span></code> 。大多数情况下，两者是一致的。然而在一些情况下，传递给operators的是自定义context，所以脚本作者更愿意传递 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数至operator。</p>
</div>
<p>要测试这段脚本，你可以将其复制粘贴到Blender文本编辑器，并运行。这将直接执行脚本，并立即调用register函数。</p>
<p>不过，运行该脚本不能直接移动物体。你需要执行新注册的operator。</p>
<div class="figure align-default" id="id2">
<img alt="../../_images/advanced_scripting_addon-tutorial_operator-search-menu.png" src="../../_images/advanced_scripting_addon-tutorial_operator-search-menu.png" />
<p class="caption"><span class="caption-text">操作搜索菜单。</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Open the <a class="reference internal" href="../../interface/controls/templates/operator_search.html#bpy-ops-wm-search-operator"><span class="std std-ref">Operator Search</span></a> menu
and type in &quot;Move X by One&quot; (the <code class="docutils literal notranslate"><span class="pre">bl_label</span></code>), then <kbd class="kbd docutils literal notranslate">Return</kbd>.</p>
<p>物体将与前文一样移动。</p>
<p><em>不要关闭文本编辑器，下一步安装需要用到</em></p>
</div>
<div class="section" id="install-the-add-on">
<h3>安装插件<a class="headerlink" href="#install-the-add-on" title="Permalink to this headline">¶</a></h3>
<p>在Blender文本编辑器写好插件后，你可能想要安装该插件，这样就可以在用户设置中启用启动时加载插件。</p>
<p>尽管上面的插件只是一个测试，但还是把这些步骤都走一遍，这样以后就知道该怎么做了。</p>
<p>要安装Blender文本编辑器里写的插件，首先需要存盘，注意遵守Python模块的命名限制， 并以 <code class="docutils literal notranslate"><span class="pre">.py</span></code> 作为扩展名。</p>
<p>存盘之后，就可以跟从网上下载的插件一样安装了。</p>
<p>打开 <span class="menuselection">用户设置 ‣ 插件 ‣ 安装...</span> ，并选择该文件。</p>
<p>现在插件就添加到了插件列表，可以勾选启用，如果要在下次启动时加载，可以 <em>保存用户设置</em> 。可以按照 <a class="reference external" href="WritetheAdd-on(Simple)">上一节</a> 中讲的方法运行该操作。</p>
<p>启用加载项后，Blender 将执行代码并运行 <code class="docutils literal notranslate"><span class="pre">register()</span></code> 函数。禁用加载项后，Blender则运行 <code class="docutils literal notranslate"><span class="pre">unregister()</span></code> 函数。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>插件的安装位置取决于你的Blender配置。安装插件时，控制台会提示插件的原始和目标路径。在Python控制台运行下面的脚本，也可以查找插件目标路径:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">addon_utils</span>
<span class="nb">print</span><span class="p">(</span><span class="n">addon_utils</span><span class="o">.</span><span class="n">paths</span><span class="p">())</span>
</pre></div>
</div>
<p>更多这方面内容见: <a class="reference internal" href="../blender_directory_layout.html#blender-directory-layout"><span class="std std-ref">目录布局</span></a>。</p>
</div>
</div>
</div>
<div class="section" id="your-second-add-on">
<h2>第二个插件<a class="headerlink" href="#your-second-add-on" title="Permalink to this headline">¶</a></h2>
<p>第二个插件是关于物体实例化 -- 亦即 -- 以与阵列修改器类似的方法生成物体的关联副本。</p>
<div class="section" id="id1">
<h3>写脚本<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>和前面一样，我们从一段脚本开始，然后将其转化为插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">bpy</span> <span class="kn">import</span> <span class="n">context</span>

<span class="c1"># Get the current scene</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>

<span class="c1"># Get the 3D cursor location</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>

<span class="c1"># Get the active object (assume we have one)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

<span class="c1"># Now make a copy of the object</span>
<span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># The new object has to be added to a collection in the scene</span>
<span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

<span class="c1"># Now we can place the object</span>
<span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">cursor</span>
</pre></div>
</div>
<p>现在，把这段脚本复制到Blende文本编辑器，选择立方体并运行脚本。运行脚本前记得单击将3D游标移动一旁，副本物体将出现在游标位置。</p>
<p>运行过后，进入 <em>编辑模式</em> 修改立方体后 -- 所有的副本会同时变化，这在Blender里称作 <em>关联副本</em>。</p>
<p>下一步，把这段脚本加到循环里，在活动物体与游标之间生成物体阵列。:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">bpy</span> <span class="kn">import</span> <span class="n">context</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

<span class="c1"># Use a fixed value for now, eventually make this user adjustable</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Add &#39;total&#39; objects into the scene</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
    <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

    <span class="c1"># Now place the object in between the cursor</span>
    <span class="c1"># and the active object based on &#39;i&#39;</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>
</pre></div>
</div>
<p>将3D游标远离活动物体，运行脚本，查看结果。</p>
<p>在这段脚本里，对物体和游标位置做了一点数学运算，这是因为两者都是3D <code class="xref py py-class docutils literal notranslate"><span class="pre">mathutils.</span> <span class="pre">Vector</span></code> 实例， <a class="reference external" href="https://docs.blender.org/api/2.90/mathutils.html#module-mathutils" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">mathutils</span></code></a> 模块提供了这个方便的类， 并且允许向量与数值和矩阵做乘法运算。</p>
<p>如果你对这方面感兴趣的话，可以进一步阅读 <a class="reference external" href="https://docs.blender.org/api/2.90/mathutils.html#mathutils.Vector" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">mathutils.Vector</span></code></a> -- 这里有很多方便的工具函数如计算向量夹角、叉乘、点乘， <a class="reference external" href="https://docs.blender.org/api/2.90/mathutils.geometry.html#module-mathutils.geometry" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">mathutils.geometry</span></code></a> 还提供了更高级的函数如 Bézier 样条曲线插值和射线-三角形相交。</p>
<p>现在我们专心将这段脚本编程插件，不过知道这个3D数学模块也是不错的，以后更高级的功能可能用到它。</p>
</div>
<div class="section" id="write-the-add-on">
<h3>写插件<a class="headerlink" href="#write-the-add-on" title="Permalink to this headline">¶</a></h3>
<p>首先将脚本转换为插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cursor Array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectCursorArray</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object Cursor Array&quot;&quot;&quot;</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.cursor_array&quot;</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Cursor Array&quot;</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

        <span class="n">total</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
            <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">total</span>
            <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<p>接下来的步骤上文已经介绍过了，不过你还是可以运行脚本，再考虑一下如何改进这插件的功能。</p>
<p>这个插件明显缺少两项功能 -- 总数固定为10，从 <a class="reference internal" href="../../interface/controls/templates/operator_search.html"><span class="doc">Search</span></a> 访问该操作也不是很方便。</p>
<p>下文将讲解如何改进，并给出最终脚本代码。</p>
<div class="section" id="operator-property">
<h4>操作属性<a class="headerlink" href="#operator-property" title="Permalink to this headline">¶</a></h4>
<p>There are a variety of property types that are used for tool settings, common property types include:
int, float, vector, color, Boolean and string.</p>
<p>这些属性与Python类的属性用法不同，因为Blender需要在界面显示、保存其键位映射设置，并保留设置供下次使用。</p>
<p>尽管这是相当Python化的方式，但是记住，实际上你定义的工具设置会被加载到Blender，并被Blender的其他部分从Python外部访问。</p>
<p>要消除 <code class="docutils literal notranslate"><span class="pre">总数</span></code> 为10的问题， 会用到一个操作属性。操作属性是通过 bpy.props模块定义的，将下面的代码加到operator类的主体中:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># moved assignment from execute() to the body of the class...</span>
<span class="n">total</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">IntProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Steps&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># and this is accessed on the class</span>
<span class="c1"># instance within the execute() function as...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">total</span>
</pre></div>
</div>
<p>这些来自 <a class="reference external" href="https://docs.blender.org/api/2.90/bpy.props.html#module-bpy.props" title="(in Blender 2.90.0 Beta Python API ve0772c6607ae)"><code class="docutils literal notranslate"><span class="pre">bpy.props</span></code></a> 的属性会被Blender特别处理，当(operator)类被注册后，会在界面显示属性按钮。可以传递很多参数给属性，如设置上下界、修改默认值和显示工具提示。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">bpy.props.IntProperty</span></code></p>
</div>
<p>这篇文档不会详细介绍如何使用其他属性类型，不过上面的链接包含了更高级的属性用法范例。</p>
</div>
<div class="section" id="menu-item">
<h4>菜单选项<a class="headerlink" href="#menu-item" title="Permalink to this headline">¶</a></h4>
<p>插件可以添加到现有的面板、标题栏和菜单等Python定义的用户界面中。</p>
<p>这个例子里，我们将其添加到现有菜单。</p>
<div class="figure align-default" id="id3">
<img alt="../../_images/advanced_scripting_addon-tutorial_menu-id.png" src="../../_images/advanced_scripting_addon-tutorial_menu-id.png" />
<p class="caption"><span class="caption-text">菜单标识符。</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>先在用户设置中启用 <em>Python工具提示</em>，鼠标在菜单上方停留，会出现提示，就能找到菜单标识符了。</p>
<p>添加菜单选项的方式是，在给现有类追加一个绘制函数:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">menu_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>
</pre></div>
</div>
<p>扩展菜单的文档，请参考 <code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.Menu</span></code>。</p>
</div>
<div class="section" id="keymap">
<h4>键位映射<a class="headerlink" href="#keymap" title="Permalink to this headline">¶</a></h4>
<p>在Blender中，插件可以有自己的键位映射，以避免与Blender内置键位映射冲突。</p>
<p>在下面的例子中，添加了一个新的物体模式 <code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMap</span></code> ，接着向该键位映射添加了一个 <code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMapItem</span></code> ，指向新添加的操作，使用 <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Shift</kbd>-<kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">T</kbd></kbd> 作为快捷键</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store keymaps here to access after registration</span>
<span class="n">addon_keymaps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="c1"># handle the keymap</span>
    <span class="n">wm</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window_manager</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span><span class="o">.</span><span class="n">keymaps</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Object Mode&#39;</span><span class="p">,</span> <span class="n">space_type</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>

    <span class="n">kmi</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESS&#39;</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">kmi</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">km</span><span class="p">,</span> <span class="n">kmi</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>

    <span class="c1"># handle the keymap</span>
    <span class="k">for</span> <span class="n">km</span><span class="p">,</span> <span class="n">kmi</span> <span class="ow">in</span> <span class="n">addon_keymaps</span><span class="p">:</span>
        <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kmi</span><span class="p">)</span>
    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>值得注意的是，键位映射的 <code class="docutils literal notranslate"><span class="pre">total</span></code> 值与operator的默认值不同，这样就可以通过不同按键组合访问不同设置的同一operator。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Shift</kbd>-<kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">T</kbd></kbd> is not a default Blender key shortcut,
it is hard to make sure add-ons will not overwrite each other's keymaps.
Thus at least take care when assigning keys that they do not
conflict with important functionality of Blender
(see also <a class="reference internal" href="../../addons/development/is_key_free.html"><span class="doc">Is Key Free</span></a>).</p>
</div>
<p>上文所用函数的API文档，见：</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMaps.new</span></code>,</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMap</span></code>,</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMapItems.new</span></code>,</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.KeyMapItem</span></code>.</p></li>
</ul>
</div>
<div class="section" id="bringing-it-all-together">
<h4>合二为一<a class="headerlink" href="#bringing-it-all-together" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cursor Array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectCursorArray</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object Cursor Array&quot;&quot;&quot;</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.cursor_array&quot;</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Cursor Array&quot;</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>

    <span class="n">total</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">IntProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Steps&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">):</span>
            <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
            <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">menu_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">)</span>

<span class="c1"># store keymaps here to access after registration</span>
<span class="n">addon_keymaps</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>

    <span class="c1"># handle the keymap</span>
    <span class="n">wm</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window_manager</span>
    <span class="c1"># Note that in background mode (no GUI available), keyconfigs are not available either,</span>
    <span class="c1"># so we have to check this to avoid nasty errors in background case.</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span>
    <span class="k">if</span> <span class="n">kc</span><span class="p">:</span>
        <span class="n">km</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span><span class="o">.</span><span class="n">keymaps</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Object Mode&#39;</span><span class="p">,</span> <span class="n">space_type</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>
        <span class="n">kmi</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESS&#39;</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">kmi</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">km</span><span class="p">,</span> <span class="n">kmi</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="c1"># Note: when unregistering, it&#39;s usually good practice to do it in reverse order you registered.</span>
    <span class="c1"># Can avoid strange issues like keymap still referring to operators already unregistered...</span>
    <span class="c1"># handle the keymap</span>
    <span class="k">for</span> <span class="n">km</span><span class="p">,</span> <span class="n">kmi</span> <span class="ow">in</span> <span class="n">addon_keymaps</span><span class="p">:</span>
        <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kmi</span><span class="p">)</span>
    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id4">
<img alt="../../_images/advanced_scripting_addon-tutorial_in-menu.png" src="../../_images/advanced_scripting_addon-tutorial_in-menu.png" />
<p class="caption"><span class="caption-text">菜单选项。</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>运行该脚本(或保存后通过用户设置安装)，操作会出现在 <em>物体</em> 菜单中。</p>
<div class="figure align-default" id="id5">
<img alt="../../_images/advanced_scripting_addon-tutorial_op-prop.png" src="../../_images/advanced_scripting_addon-tutorial_op-prop.png" />
<p class="caption"><span class="caption-text">操作属性。</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>从菜单执行操作后，你还可以选择添加的立方体数量。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>直接运行脚本多次，会添加多个菜单选项。不过这没什么好担心的，因为从用户设置启用插件是不会出现重复注册的问题的。</p>
</div>
</div>
</div>
</div>
<div class="section" id="conclusions">
<h2>结语<a class="headerlink" href="#conclusions" title="Permalink to this headline">¶</a></h2>
<p>插件可以整洁地封装特定功能，用于编写工具改善工作流，或者编写功能供其他人使用。</p>
<p>尽管Blender中Python可以做的还存在一些限制，不过已经可以实现相当多的功能，使用户免于钻研Blender的 C/C++ 源码。</p>
<p>教程里可以给出的范例始终是有限的，不过已经演示了用于常见任务的Blender API，用户可以借此延伸出自己的工具。</p>
<div class="section" id="further-reading">
<h3>扩展阅读<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h3>
<p>Blender附带了一些注释过的模板，可以在文本编辑器标题栏找到，如果你需要某个方面的示例代码，从这里开始是一个不错的选择。</p>
<p>看完上面的教程过后，这里提供了几个你可能用到的网址。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.blender.org/api/blender_python_api_current/info_overview.html">Blender/Python API 概述</a> -- <em>关于Blender/Python整合的更多背景细节。</em></p></li>
<li><p><a class="reference external" href="http://interactivepython.org/courselib/static/thinkcspy/index.html">如何像计算机科学家一样思考</a> -- <em>给哪些仍在学习Python的资料</em></p></li>
<li><p><a class="reference external" href="https://wiki.blender.org">Blender开发 (Wiki)</a> -- <em>Blender开发、基本信息和有用链接。</em></p></li>
<li><p><a class="reference external" href="https://devtalk.blender.org/tag/python">DevTalk</a> --
<em>Forum where people ask Python development questions.</em></p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../app_templates.html" class="btn btn-neutral float-right" title="应用模板" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="security.html" class="btn btn-neutral float-left" title="脚本与安全" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        
        &copy; <a href="../../copyright.html">Copyright</a> : This page is licensed under a CC-BY-SA 4.0 Int. License

    </p>
  </div>
      <div class="footer-contribute">
         <ul>
            <li>
               <a href="https://developer.blender.org/diffusion/BM/browse/trunk/blender_docs/manual/advanced/scripting/addon_tutorial.rst" class="fa fa-edit"> 编辑页面</a>
            </li>
            <li>
               <a href="https://developer.blender.org/maniphest/task/edit/form/default/?description=Pagename%3A%20%60advanced/scripting/addon_tutorial%60&project=PHID-PROJ-c4nvvrxuczix2326vlti" class="fa fa-bug"> 报告错误</a>
            </li>
         <ul>
      </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="document versions">
<ul id="versionwrap" role="presentation">
   <li style="float:left" role="presentation">
		<span id="version-dropdown" class="version-btn" tabindex="0" role="button" aria-label="versions selector" aria-haspopup="true" aria-controls="version-vsnlist" aria-disabled="true">
		2.90 
		</span>
		<ul id="version-vsnlist" class="version-list" role="menu" aria-labelledby="version-dropdown" aria-hidden="true">
			<li role="presentation">Loading...</li>
		</ul>
	</li>
   <li style="float:right" role="presentation">
		<span id="lang-dropdown" class="version-btn" tabindex="0" role="button"  aria-label="language selector" aria-haspopup="true" aria-controls="version-langlist">
			 zh-hans 
		</span>
		<ul id="version-langlist" class="version-list" role="menu" aria-labelledby="lang-dropdown" aria-hidden="true">
			<li role="presentation">Loading...</li>
		</ul>
	</li>
</ul>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-1418081-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>
</html>